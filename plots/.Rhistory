domain = domain,
na.color = "#005C55FF"
)) %>%
text_transform(
locations = cells_body(columns = "logo"),
fn = function(x) map_chr(x, ~{
local_image(filename =  as.character(.x), height = 30)
})
) %>%
tab_options(
heading.title.font.size = 20,
heading.subtitle.font.size = 14,
heading.title.font.weight = 'bold',
column_labels.font.size = 14,
column_labels.font.weight = 'bold',
table.font.size = 12,
source_notes.font.size = 8,
data_row.padding = px(.8)
) %>%
tab_source_note(
source_note = md("The Alan Turing Institute (Nick Barlow, Jack Roberts, Ryan Chan)<br>Based on 100,000 simulations<br>Data: GitHub (martj42/international_results)<br>Country Images: Flaticon.com and GitHub (lbenz730/world_cup_2022)")
)
if (!is.null(filename)) {
gtsave(full_table, filename = filename)
}
return(full_table)
}
create_table_plot_alt_colours <- function(data_frame,
data_frame_for_colours,
domain,
subtitle = "",
filename = NULL) {
full_table <- create_table_plot(data_frame, domain, subtitle)
full_table$`_data` <- tibble(data_frame_for_colours %>%
mutate('logo' = paste0('flags/', Team, '.png')) %>%
select(Team, logo, everything()))
if (!is.null(filename)) {
gtsave(full_table, filename = filename)
}
return(full_table)
}
create_table_plot(prog_round_1, c(-0.2, 1))
create_table_plot(prog_round_1, c(-0.5, 1))
create_table_plot(prog_difference, c(-0.4, 0.4))
create_table_plot(diff, c(-0.4, 0.4))
create_table_plot(diff, c(-0.5, 0.5))
create_table_plot(diff, c(-0.5, 0.5), subtitle = "Difference in probability compared to original predictions")
create_table_plot(diff, c(-0.5, 0.5), subtitle = "Difference in probability after Round 1 compared to original predictions")
create_table_plot(diff, c(-0.5, 0.5), subtitle = "Difference in probability after Round 1 compared to original predictions")
create_table_plot(diff, c(-0.5, 0.5), subtitle = "Difference in probability after Round 1")
create_table_plot_alt_colours(prog_round_1, diff, c(-0.5, 0.5))
full_table$`_data` <- tibble(data_frame %>%
mutate('logo' = paste0('flags/', Team, '.png')) %>%
select(Team, logo, everything()))
create_table_plot_alt_colours <- function(data_frame,
data_frame_for_colours,
domain,
subtitle = "",
filename = NULL) {
full_table <- create_table_plot(data_frame_for_colours, domain, subtitle)
full_table$`_data` <- tibble(data_frame %>%
mutate('logo' = paste0('flags/', Team, '.png')) %>%
select(Team, logo, everything()))
if (!is.null(filename)) {
gtsave(full_table, filename = filename)
}
return(full_table)
}
create_table_plot(prog_round_1, c(-0.5, 1))
create_table_plot(diff, c(-0.5, 0.5), subtitle = "Difference in probability after Round 1")
create_table_plot_alt_colours(diff, diff, c(-0.5, 0.5))
create_table_plot_alt_colours(prog_round_1, diff, c(-0.5, 0.5))
create_table_plot(prog_round_1, c(-0.5, 1), filename = "after_round_1.png")
create_table_plot(diff, c(-0.5, 0.5), subtitle = "Difference in probability after Round 1", filename = "after_round_1_diff.png")
create_table_plot_alt_colours(prog_round_1, diff, c(-0.5, 0.5), filename = "after_round_1_colour_diff.png")
create_table_plot(prog_round_1, c(-0.5, 1), filename = "after_round_1.png")
create_table_plot(diff, c(-0.5, 0.5), subtitle = "Difference in probability after Round 1", filename = "after_round_1_diff.png")
create_table_plot_alt_colours(prog_round_1, diff, c(-0.5, 0.5), filename = "after_round_1_colour_diff.png")
create_table_plot(prog_round_1, c(-0.5, 1), subtitle = "After Round 1", filename = "after_round_1.png")
create_table_plot(diff, c(-0.5, 0.5), subtitle = "Difference in probability after Round 1", filename = "after_round_1_diff.png")
create_table_plot(prog_round_1, c(-0.5, 1), subtitle = "After Round 1", filename = "after_round_1.png")
create_table_plot(diff, c(-0.5, 0.5), subtitle = "Difference in probability after Round 1", filename = "after_round_1_diff.png")
create_table_plot_alt_colours(prog_round_1, diff, c(-0.5, 0.5), subtitle = "After Round 1", filename = "after_round_1_colour_diff.png")
create_table_plot(original_prob, c(-0.5, 1), filename = "predictions1.png")
# original plot
original_prob <- get_progression_probabiltiies(original, 100000)
# # before World Cup
original <- read.csv("merged_1668598471_ep_2_wc_4_100000.csv")
# after Round 1 games
round_1 <- read.csv("1669331060_sim_results.csv")
# original plot
original_prob <- get_progression_probabiltiies(original, 100000)
create_table_plot(original_prob, c(-0.5, 1), filename = "predictions1.png")
# after round 1 plots
after_round_1_prob <- get_progression_probabiltiies(round_1, 100000)
after_round_1_diff <- get_progression_prob_differences(new_df = after_round_1_prob,
old_df = original_prob)
create_table_plot(prog_round_1, c(-0.5, 1), subtitle = "After Round 1", filename = "after_round_1.png")
create_table_plot(diff, c(-0.5, 0.5), subtitle = "Difference in probability after Round 1", filename = "after_round_1_diff.png")
create_table_plot_alt_colours(prog_round_1, diff, c(-0.5, 0.5), subtitle = "After Round 1", filename = "after_round_1_colour_diff.png")
create_table_plot(original_prob, c(-0.5, 1), filename = "predictions.png")
# load packages
library(tidyverse)
library(gt)
library(gtExtras)
library(webshot2)
# # before World Cup
original <- read.csv("merged_1668598471_ep_2_wc_4_100000.csv")
# after Round 1 games
round_1 <- read.csv("1669331060_sim_results.csv")
get_progression_probabiltiies <- function(df, n_sim) {
df <- df[order(df$W, decreasing = TRUE),]
prog_df <- data.frame(matrix(nrow=0, ncol = 5))
for (i in 1:nrow(df)) {
progression <- c(sum(df[i, c("R16", "QF", "SF", "RU", "W")]) / n_sim,
sum(df[i, c("QF", "SF", "RU", "W")]) / n_sim,
sum(df[i, c("SF", "RU", "W")]) / n_sim,
sum(df[i, c("RU", "W")]) / n_sim,
sum(df[i, c("W")]) / n_sim)
prog_df <- rbind(prog_df, progression)
}
if ("team" %in% colnames(df)) {
prog_df <- cbind(df$team, prog_df)
} else if ("Team" %in% colnames(df)) {
prog_df <- cbind(df$Team, prog_df)
}
colnames(prog_df) <- c("Team", "R16", "QF", "SF", "F", "W")
return(prog_df)
}
get_progression_prob_differences <- function(new_df, old_df) {
prog_difference <- data.frame(matrix(nrow=0, ncol = 5))
for (i in 1:nrow(new_df)) {
team <- new_df[i,]$Team
new_probabilities <- new_df[new_df$Team==team, c("R16", "QF", "SF", "F", "W")]
old_probabilities <- old_df[old_df$Team==team, c("R16", "QF", "SF", "F", "W")]
prog_difference <- rbind(prog_difference, new_probabilities-old_probabilities)
}
if ("team" %in% colnames(new_df)) {
prog_difference <- cbind(new_df$team, prog_difference)
} else if ("Team" %in% colnames(new_df)) {
prog_difference <- cbind(new_df$Team, prog_difference)
}
colnames(prog_difference) <- c("Team", "R16", "QF", "SF", "F", "W")
return(prog_difference)
}
create_table_plot <- function(data_frame,
domain,
subtitle = "",
filename = NULL) {
full_table <- data_frame %>%
mutate('logo' = paste0('flags/', Team, '.png')) %>%
select(Team, logo, everything()) %>%
gt() %>%
tab_header(
title = md("**World Cup 2022**"),
subtitle = subtitle) %>%
cols_label(Team = "",
logo = "") %>%
cols_width(Team ~ 80,
logo ~ 50,
everything() ~ 60) %>%
fmt_percent(columns = c(R16, QF, SF, F, W),
decimals = 1) %>%
data_color(columns = c(R16, QF, SF, F, W),
colors = scales::col_numeric(
palette = paletteer::paletteer_d(
palette = "Redmonder::dPBIRdGn",
direction = 1
) %>% as.character(),
domain = domain,
na.color = "#005C55FF"
)) %>%
text_transform(
locations = cells_body(columns = "logo"),
fn = function(x) map_chr(x, ~{
local_image(filename =  as.character(.x), height = 30)
})
) %>%
tab_options(
heading.title.font.size = 20,
heading.subtitle.font.size = 14,
heading.title.font.weight = 'bold',
column_labels.font.size = 14,
column_labels.font.weight = 'bold',
table.font.size = 12,
source_notes.font.size = 8,
data_row.padding = px(.8)
) %>%
tab_source_note(
source_note = md("The Alan Turing Institute (Nick Barlow, Jack Roberts, Ryan Chan)<br>Based on 100,000 simulations<br>Data: GitHub (martj42/international_results)<br>Country Images: Flaticon.com and GitHub (lbenz730/world_cup_2022)")
)
if (!is.null(filename)) {
gtsave(full_table, filename = filename)
}
return(full_table)
}
create_table_plot_alt_colours <- function(data_frame,
data_frame_for_colours,
domain,
subtitle = "",
filename = NULL) {
full_table <- create_table_plot(data_frame_for_colours, domain, subtitle)
full_table$`_data` <- tibble(data_frame %>%
mutate('logo' = paste0('flags/', Team, '.png')) %>%
select(Team, logo, everything()))
if (!is.null(filename)) {
gtsave(full_table, filename = filename)
}
return(full_table)
}
# original plot
original_prob <- get_progression_probabiltiies(original, 100000)
create_table_plot(original_prob, c(-0.5, 1), filename = "plots/predictions.png")
# after round 1 plots
after_round_1_prob <- get_progression_probabiltiies(round_1, 100000)
after_round_1_diff <- get_progression_prob_differences(new_df = after_round_1_prob,
old_df = original_prob)
create_table_plot(data_frame = prog_round_1,
domain = c(-0.5, 1),
subtitle = "After Round 1",
filename = "plots/after_round_1.png")
create_table_plot(data_frame = after_round_1_prob,
domain = c(-0.5, 1),
subtitle = "After Round 1",
filename = "plots/after_round_1.png")
create_table_plot(data_frame = after_round_1_diff,
domain = c(-0.5, 0.5),
subtitle = "Difference in probability after Round 1",
filename = "plots/after_round_1_diff.png")
create_table_plot_alt_colours(data_frame = after_round_1_prob,
data_frame_for_colours = after_round_1_diff,
domain = c(-0.5, 0.5),
subtitle = "After Round 1",
filename = "plots/after_round_1_colour_diff.png")
# # before World Cup
original <- read.csv("original_predictions.csv")
# after Round 1 games
round_1 <- read.csv("after_round_1.csv")
# after Round 1 games and Wales-Iran
round_1 <- read.csv("after_round_1_wales_iran.csv")
# # before World Cup
original <- read.csv("original_predictions.csv")
# after Round 1 games
round_1 <- read.csv("after_round_1.csv")
# after Round 1 games and Wales-Iran
round_1_WI <- read.csv("after_round_1_wales_iran.csv")
get_progression_probabiltiies <- function(df, n_sim) {
df <- df[order(df$W, decreasing = TRUE),]
prog_df <- data.frame(matrix(nrow=0, ncol = 5))
for (i in 1:nrow(df)) {
progression <- c(sum(df[i, c("R16", "QF", "SF", "RU", "W")]) / n_sim,
sum(df[i, c("QF", "SF", "RU", "W")]) / n_sim,
sum(df[i, c("SF", "RU", "W")]) / n_sim,
sum(df[i, c("RU", "W")]) / n_sim,
sum(df[i, c("W")]) / n_sim)
prog_df <- rbind(prog_df, progression)
}
if ("team" %in% colnames(df)) {
prog_df <- cbind(df$team, prog_df)
} else if ("Team" %in% colnames(df)) {
prog_df <- cbind(df$Team, prog_df)
}
colnames(prog_df) <- c("Team", "R16", "QF", "SF", "F", "W")
return(prog_df)
}
get_progression_prob_differences <- function(new_df, old_df) {
prog_difference <- data.frame(matrix(nrow=0, ncol = 5))
for (i in 1:nrow(new_df)) {
team <- new_df[i,]$Team
new_probabilities <- new_df[new_df$Team==team, c("R16", "QF", "SF", "F", "W")]
old_probabilities <- old_df[old_df$Team==team, c("R16", "QF", "SF", "F", "W")]
prog_difference <- rbind(prog_difference, new_probabilities-old_probabilities)
}
if ("team" %in% colnames(new_df)) {
prog_difference <- cbind(new_df$team, prog_difference)
} else if ("Team" %in% colnames(new_df)) {
prog_difference <- cbind(new_df$Team, prog_difference)
}
colnames(prog_difference) <- c("Team", "R16", "QF", "SF", "F", "W")
return(prog_difference)
}
create_table_plot <- function(data_frame,
domain,
subtitle = "",
filename = NULL) {
full_table <- data_frame %>%
mutate('logo' = paste0('flags/', Team, '.png')) %>%
select(Team, logo, everything()) %>%
gt() %>%
tab_header(
title = md("**World Cup 2022**"),
subtitle = subtitle) %>%
cols_label(Team = "",
logo = "") %>%
cols_width(Team ~ 80,
logo ~ 50,
everything() ~ 60) %>%
fmt_percent(columns = c(R16, QF, SF, F, W),
decimals = 1) %>%
data_color(columns = c(R16, QF, SF, F, W),
colors = scales::col_numeric(
palette = paletteer::paletteer_d(
palette = "Redmonder::dPBIRdGn",
direction = 1
) %>% as.character(),
domain = domain,
na.color = "#005C55FF"
)) %>%
text_transform(
locations = cells_body(columns = "logo"),
fn = function(x) map_chr(x, ~{
local_image(filename =  as.character(.x), height = 30)
})
) %>%
tab_options(
heading.title.font.size = 20,
heading.subtitle.font.size = 14,
heading.title.font.weight = 'bold',
column_labels.font.size = 14,
column_labels.font.weight = 'bold',
table.font.size = 12,
source_notes.font.size = 8,
data_row.padding = px(.8)
) %>%
tab_source_note(
source_note = md("The Alan Turing Institute (Nick Barlow, Jack Roberts, Ryan Chan)<br>Based on 100,000 simulations<br>Data: GitHub (martj42/international_results)<br>Country Images: Flaticon.com and GitHub (lbenz730/world_cup_2022)")
)
if (!is.null(filename)) {
gtsave(full_table, filename = filename)
}
return(full_table)
}
create_table_plot_alt_colours <- function(data_frame,
data_frame_for_colours,
domain,
subtitle = "",
filename = NULL) {
full_table <- create_table_plot(data_frame_for_colours, domain, subtitle)
full_table$`_data` <- tibble(data_frame %>%
mutate('logo' = paste0('flags/', Team, '.png')) %>%
select(Team, logo, everything()))
if (!is.null(filename)) {
gtsave(full_table, filename = filename)
}
return(full_table)
}
# after round 1 plots with Wales-Iran
after_round_1_prob <- get_progression_probabiltiies(round_1_WI, 100000)
after_round_1_diff <- get_progression_prob_differences(new_df = after_round_1_prob,
old_df = original_prob)
create_table_plot(data_frame = after_round_1_prob,
domain = c(-0.5, 1),
subtitle = "After Round 1",
filename = "plots/after_round_1_WI.png")
create_table_plot(data_frame = after_round_1_diff,
domain = c(-0.5, 0.5),
subtitle = "Difference in probability after Round 1",
filename = "plots/after_round_1_WI_diff.png")
create_table_plot_alt_colours(data_frame = after_round_1_prob,
data_frame_for_colours = after_round_1_diff,
domain = c(-0.5, 0.5),
subtitle = "After Round 1",
filename = "plots/after_round_1_WI_colour_diff.png")
after_round_1_prob
create_table_plot(data_frame = after_round_1_prob,
domain = c(-0.5, 1),
subtitle = "After Round 1 (and Wales-Iran)",
filename = "plots/after_round_1_WI.png")
# load packages
library(tidyverse)
library(gt)
library(gtExtras)
library(webshot2)
# # before World Cup
original <- read.csv("original_predictions.csv")
# after Round 1 games
round_1 <- read.csv("after_round_1.csv")
# after Round 1 games and Wales-Iran
round_1_WI <- read.csv("after_round_1_wales_iran.csv")
setwd("~/Library/CloudStorage/OneDrive-TheAlanTuringInstitute/WorldCupPrediction/plots/plots")
setwd("~/Library/CloudStorage/OneDrive-TheAlanTuringInstitute/WorldCupPrediction/plots")
get_progression_probabiltiies <- function(df, n_sim) {
df <- df[order(df$W, decreasing = TRUE),]
prog_df <- data.frame(matrix(nrow=0, ncol = 5))
for (i in 1:nrow(df)) {
progression <- c(sum(df[i, c("R16", "QF", "SF", "RU", "W")]) / n_sim,
sum(df[i, c("QF", "SF", "RU", "W")]) / n_sim,
sum(df[i, c("SF", "RU", "W")]) / n_sim,
sum(df[i, c("RU", "W")]) / n_sim,
sum(df[i, c("W")]) / n_sim)
prog_df <- rbind(prog_df, progression)
}
if ("team" %in% colnames(df)) {
prog_df <- cbind(df$team, prog_df)
} else if ("Team" %in% colnames(df)) {
prog_df <- cbind(df$Team, prog_df)
}
colnames(prog_df) <- c("Team", "R16", "QF", "SF", "F", "W")
return(prog_df)
}
get_progression_prob_differences <- function(new_df, old_df) {
prog_difference <- data.frame(matrix(nrow=0, ncol = 5))
for (i in 1:nrow(new_df)) {
team <- new_df[i,]$Team
new_probabilities <- new_df[new_df$Team==team, c("R16", "QF", "SF", "F", "W")]
old_probabilities <- old_df[old_df$Team==team, c("R16", "QF", "SF", "F", "W")]
prog_difference <- rbind(prog_difference, new_probabilities-old_probabilities)
}
if ("team" %in% colnames(new_df)) {
prog_difference <- cbind(new_df$team, prog_difference)
} else if ("Team" %in% colnames(new_df)) {
prog_difference <- cbind(new_df$Team, prog_difference)
}
colnames(prog_difference) <- c("Team", "R16", "QF", "SF", "F", "W")
return(prog_difference)
}
create_table_plot <- function(data_frame,
domain,
subtitle = "",
filename = NULL) {
full_table <- data_frame %>%
mutate('logo' = paste0('flags/', Team, '.png')) %>%
select(Team, logo, everything()) %>%
gt() %>%
tab_header(
title = md("**World Cup 2022**"),
subtitle = subtitle) %>%
cols_label(Team = "",
logo = "") %>%
cols_width(Team ~ 80,
logo ~ 50,
everything() ~ 60) %>%
fmt_percent(columns = c(R16, QF, SF, F, W),
decimals = 1) %>%
data_color(columns = c(R16, QF, SF, F, W),
colors = scales::col_numeric(
palette = paletteer::paletteer_d(
palette = "Redmonder::dPBIRdGn",
direction = 1
) %>% as.character(),
domain = domain,
na.color = "#005C55FF"
)) %>%
text_transform(
locations = cells_body(columns = "logo"),
fn = function(x) map_chr(x, ~{
local_image(filename =  as.character(.x), height = 30)
})
) %>%
tab_options(
heading.title.font.size = 20,
heading.subtitle.font.size = 14,
heading.title.font.weight = 'bold',
column_labels.font.size = 14,
column_labels.font.weight = 'bold',
table.font.size = 12,
source_notes.font.size = 8,
data_row.padding = px(.8)
) %>%
tab_source_note(
source_note = md("The Alan Turing Institute (Nick Barlow, Jack Roberts, Ryan Chan)<br>Based on 100,000 simulations<br>Data: GitHub (martj42/international_results)<br>Country Images: Flaticon.com and GitHub (lbenz730/world_cup_2022)")
)
if (!is.null(filename)) {
gtsave(full_table, filename = filename)
}
return(full_table)
}
create_table_plot_alt_colours <- function(data_frame,
data_frame_for_colours,
domain,
subtitle = "",
filename = NULL) {
full_table <- create_table_plot(data_frame_for_colours, domain, subtitle)
full_table$`_data` <- tibble(data_frame %>%
mutate('logo' = paste0('flags/', Team, '.png')) %>%
select(Team, logo, everything()))
if (!is.null(filename)) {
gtsave(full_table, filename = filename)
}
return(full_table)
}
# after round 1 plots with Wales-Iran
after_round_1_prob <- get_progression_probabiltiies(round_1_WI, 100000)
after_round_1_diff <- get_progression_prob_differences(new_df = after_round_1_prob,
old_df = original_prob)
create_table_plot(data_frame = after_round_1_prob,
domain = c(-0.5, 1),
subtitle = "After Round 1 (and Wales-Iran)",
filename = "plots/after_round_1_WI.png")
# original plot
original_prob <- get_progression_probabiltiies(original, 100000)
# after round 1 plots with Wales-Iran
after_round_1_prob <- get_progression_probabiltiies(round_1_WI, 100000)
after_round_1_diff <- get_progression_prob_differences(new_df = after_round_1_prob,
old_df = original_prob)
# after round 1 plots with Wales-Iran
after_round_1_prob <- get_progression_probabiltiies(round_1_WI, 100000)
after_round_1_diff <- get_progression_prob_differences(new_df = after_round_1_prob,
old_df = original_prob)
create_table_plot(data_frame = after_round_1_prob,
domain = c(-0.5, 1),
subtitle = "After Round 1 (and Wales-Iran)",
filename = "plots/after_round_1_WI.png")
create_table_plot(data_frame = after_round_1_diff,
domain = c(-0.5, 0.5),
subtitle = "Difference in probability after Round 1 (and Wales-Iran)",
filename = "plots/after_round_1_WI_diff.png")
create_table_plot_alt_colours(data_frame = after_round_1_prob,
data_frame_for_colours = after_round_1_diff,
domain = c(-0.5, 0.5),
subtitle = "After Round 1 (and Wales-Iran)",
filename = "plots/after_round_1_WI_colour_diff.png")
